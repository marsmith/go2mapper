webpackJsonp([0],[function(e,a,t){(function(e,a,t,r,i){function o(){e.getJSON(noaaSitesJSON,function(a){e.each(a,function(e,a){E[e]&&(E[e].properties.ahpsID=a)})})}function n(){W.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/Conus/RadarImg/northeast_radaronly.gif",[[35.13102,-81.613834],[49.508061,-66.517938]])),A.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/ENX_N0Z_0.gif",[[38.578726,-78.420367],[46.578726,-69.693094]])),A.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/BGM_N0Z_0.gif",[[38.193727,-80.341364],[46.193727,-71.614092]])),A.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/BUF_N0Z_0.gif\t",[[38.941729,-83.093363],[46.941729,-74.36609]])),A.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/TYX_N0Z_0.gif",[[39.748728,-80.036364],[47.748728,-71.309091]])),A.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/OKX_N0Z_0.gif",[[36.858728,-77.220362],[44.858728,-68.493089]])),U.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/ENX_N0R_0.gif",[[39.894591,-76.989871],[45.267637,-71.128366]])),U.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/BGM_N0R_0.gif",[[39.526025,-78.893004],[44.866266,-73.067287]])),U.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/BUF_N0R_0.gif",[[40.241795,-81.680043],[45.646381,-75.78413]])),U.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/TYX_N0R_0.gif",[[41.012603,-78.662387],[46.48944,-72.687656]])),U.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/OKX_N0R_0.gif",[[38.245599,-75.712675],[43.476892,-70.00581]])),z.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/ENX_NTP_0.gif",[[39.894178,-76.99032],[45.268049,-71.127915]])),z.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/BGM_NTP_0.gif",[[39.52562,-78.893445],[44.866669,-73.066846]])),z.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/BUF_NTP_0.gif",[[40.241382,-81.680491],[45.646793,-75.78368]])),z.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/TYX_NTP_0.gif",[[41.01219,-78.662836],[46.489851,-72.687205]])),z.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/OKX_NTP_0.gif",[[38.245202,-75.713107],[43.477288,-70.005377]]))}function s(a){if("sw"===a.layer.properties.siteType||"gw"===a.layer.properties.siteType){var t="00060,00065,62614,62615,62619,72214,72264,72019",r="P7D";e.getJSON("https://staging.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+a.layer.properties.siteID+"&parameterCd="+t+"&period="+r,function(t){if(!t.data||t.data[0].time_series_data.length<=0)return setTimeout(function(){e("#graphLoader").hide()},500),void console.log("Found an NWIS site, but it had no data in waterservices: ",a.layer.properties.siteID);var r=[];console.log("NWIS data:",t);var i="",o="",n=!1,s={};if(e.each(t.data,function(e,a){a.parameter_name.indexOf("Discharge")!==-1?(n=!0,i="Discharge, cfs",o="Discharge: {point.y} cfs",s={tooltip:{pointFormat:o},showInLegend:!1,data:a.time_series_data,name:a.parameter_name},r.push(s)):a.parameter_name.indexOf("Elevation")!==-1?(a.parameter_name+=", ft",a.loc_web_ds.length>0?a.parameter_name+=" ("+a.loc_web_ds+")":i=a.parameter_name,o=a.parameter_name+": {point.y}",s={tooltip:{pointFormat:o},showInLegend:!1,data:a.time_series_data,name:a.parameter_name},r.push(s)):"Water level, depth LSD"===a.parameter_name?(i="Elevation, ft",o="Elevation: {point.y} ft",s={tooltip:{pointFormat:o},showInLegend:!1,data:a.time_series_data,name:a.parameter_name},r.push(s)):a.parameter_name.indexOf("Gage height")===-1||n||(a.parameter_name+=", ft",a.loc_web_ds.length>0?a.parameter_name+=" ("+a.loc_web_ds+")":i=a.parameter_name,o=a.parameter_name+": {point.y}",s={tooltip:{pointFormat:o},showInLegend:!1,data:a.time_series_data,name:a.parameter_name},r.push(s))}),console.log("before all graph data:",r),E[a.layer.properties.siteID].properties.ahpsID){console.log("Found AHPS site: ",E[a.layer.properties.siteID].properties.ahpsID,"  Querying AHPS...");var p="https://water.weather.gov/ahps2/hydrograph_to_xml.php?gage="+a.layer.properties.ahpsID+"&output=xml";console.log("AHPS page url:",p);var c="./proxy.php?url=";location.hostname.match("wim")&&(c="http://staging-ny.water.usgs.gov/maps/go2/proxy.php?url="),e.ajax({url:c+p,dataType:"xml",success:function(t){console.log("Response:",t);var s=[];if(e(t).find("forecast").find("datum").each(function(){var a=e(this).find("valid").text();if(n){var t=e(this).find("secondary").attr("units"),r=parseFloat(e(this).find("secondary").text());"kcfs"===t&&(r*=1e3)}else var t=e(this).find("primary").attr("units"),r=parseFloat(e(this).find("primary").text());var i=new Date(a)/1;s.push([i,r])}),s.sort(),s.length<=1)console.log("Found an AHPS Site, but no AHPS data was found: ",a.layer.properties.siteID,a.layer.properties.ahpsID);else{var p={tooltip:{pointFormat:o},showInLegend:!0,color:"#009933",name:"NWS River Forecast (AHPS)",data:s};r.push(p)}console.log("Calling showgraph function now..."),l(r,i)}})}else console.log("Did not find AHPS site for USGS Site: ",a.layer.properties.siteID),setTimeout(function(){l(r,i)},500)})}}function l(t,r){console.log("Calling showGraph",t),e("#graphContainer").show(),e("#graphLoader").hide(),a.setOptions({global:{useUTC:!1},lang:{thousandsSep:","}});var i={chart:{type:"line",spacingTop:20,spacingLeft:0,spacingBottom:0},title:{text:""},credits:{enabled:!1},xAxis:{type:"datetime",labels:{formatter:function(){return a.dateFormat("%m/%d",this.value)},align:"center",tickInterval:1728e5}},yAxis:{title:{text:r}},series:t};"Discharge"===t[0].name&&(i.yAxis.type="logarithmic"),"Water level, depth LSD"===t[0].name&&(i.yAxis.reversed=!0),a.chart("graphContainer",i)}function p(a){R.clearLayers(),k.clearLayers(),G.eachLayer(function(t){var r=t.getLayers();e.each(r,function(e,t){t.feature.properties.Office===a&&D.fitBounds(t.getBounds())})}),e("#tripSelect").show(),e.each(F,function(t,r){r.WSC.OfficeName.indexOf(a)!==-1&&e.each(r.WSC.Trip,function(a,t){e("#tripSelect").append(e("<option></option>").attr("value",t.TripOwner).text(t.TripName))})})}function c(a){R.clearLayers(),k.clearLayers(),hullPoints=[],e.each(F,function(t,r){r.WSC.OfficeName.indexOf(a.tripCenter)!==-1&&e.each(r.WSC.Trip,function(t,r){r.TripName==a.tripName&&e.each(r.Sites,function(e,a){d("siteslayer",a)})})}),R.getLayers().length<=2?D.fitBounds(R.getBounds()):g(a)}function g(e){var a=t(R.toGeoJSON()),r=L.geoJSON(a).bindPopup("<b>Center: </b>"+e.tripCenter+"</br><b>Trip Name: </b>"+e.tripName+"</br><b>Trip Owner: </b>"+e.tripOwner,{minWidth:200});k.addLayer(r),D.fitBounds(k.getBounds())}function d(a,t){var r=L.icon({iconUrl:"./images/symbols/selected_site_yellow.png",iconSize:[64,64]});e.each(E,function(e,a){if(a.properties.siteID===t){var i=L.marker(a.getLatLng(),{icon:r,pane:"shadowPane"});R.addLayer(i)}})}function m(){e.getJSON(subDistGeoJSON,function(a){e.each(a.features,function(a,t){e("#centerSelect").append(e("<option></option>").attr("value",t.properties.Office).text(t.properties.Office))});var t={color:"#ff8c66",weight:0,opacity:.3},r=L.geoJSON(a,{style:t});G.addLayer(r)})}function h(){var a=L.icon({iconUrl:"./images/symbols/dot_small.png",iconSize:[8,8]});e.getJSON(siteListJSON,function(t){e.each(t.SitesCollection,function(e,t){E[t.SiteID]=L.marker([t.Attributes.latDD,t.Attributes.lonDD],{icon:a}),E[t.SiteID].properties={},E[t.SiteID].properties.siteID=t.SiteID,E[t.SiteID].properties.siteName=t.Attributes.station_nm,E[t.SiteID].properties.siteType=t.Attributes.site_type,E[t.SiteID].properties.popupContent="<b>"+t.SiteID+"</b></br></br>"+t.Attributes.station_nm+'</br><a href="https://waterdata.usgs.gov/nwis/inventory/?site_no='+t.SiteID+'" target="_blank">Access Data</a></br><div id="graphLoader"><p><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw graph-loader"></i>Loading graph data...</p></div><div id="graphContainer" style="width:100%; height:200px;display:none;"></div>',E[t.SiteID].bindPopup(E[t.SiteID].properties.popupContent,{minWidth:300}),x.addLayer(E[t.SiteID])}),f(),v(go2warningsJSON),o()})}function f(){e.getJSON(tripListJSON,function(a){F=a.TripsCollection,e.each(F,function(a,t){e.each(t,function(a,t){e.each(t.Trip,function(a,r){e.each(r.Sites,function(e,a){E[a]&&(E[a].properties.tripName=r.TripName,E[a].properties.tripOwner=r.TripOwner,E[a].properties.popupContent="<b>"+a+"</b></br></br>"+E[a].properties.siteName+'</br><a href="https://waterdata.usgs.gov/nwis/inventory/?site_no='+a+'" target="_blank">Access Data</a></br></br><b>Office: </b>'+t.OfficeName+"</br><b>Trip Name: </b>"+E[a].properties.tripName+"</br><b>Trip Owner: </b>"+E[a].properties.tripOwner+'<div id="graphLoader"><p><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw graph-loader"></i>Loading graph data...</p></div><div id="graphContainer" style="width:100%; height:200px;display:none;"></div>',E[a].getPopup().setContent(E[a].properties.popupContent))})})})})})}function u(){e("#toggleGo2").text(function(e,a){return"Show Go2Lite"===a?(v(go2liteWarningsJSON),"Show Go2"):(v(go2warningsJSON),"Show Go2Lite")})}function y(e){return console.log("in select go2:",e),"Go2"===e?(v(go2warningsJSON),"Show Go2"):"Go2Lite"===e?(v(go2liteWarningsJSON),"Show Go2Lite"):"Go2Fast"===e?(v(go2predictedWarningsJSON),"Show Go2Fast"):void 0}function v(a){R.clearLayers(),k.clearLayers(),e.getJSON(a,function(a){e("#loading").hide(),e("#time").html("Data queried: "+a.metadata.created),e.each(E,function(t,r){r.getPopup().setContent(r.properties.popupContent);var i=L.icon({iconUrl:"./images/symbols/dot_small.png",iconSize:[8,8]}),o="",n=[];e.each(a.SitesCollection,function(e,a){if(r.properties.siteID===a.items.SiteID){!r.properties.tripName;var t=r.properties.siteType;for(var s in a.items.goflags){o=o+'<div class="alert alert-warning"><b>'+a.items.goflags[s].go2flag+":</b> "+a.items.goflags[s].go2msg+"</div>";var l=a.items.goflags[s].go2flag;"iGH"==a.items.goflags[s].go2flag&&a.items.goflags[s].go2msg.indexOf("meas")!=-1&&(l="iGH_meas"),n.push(l)}if(S("1DCP",n)!=-1||S("2DCP",n)!=-1||S("1GH",n)!=-1||S("2GH",n)!=-1||S("MODEM",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_red.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_red.png",iconSize:[22,30]});else if(S("1LRAT",n)!=-1||S("1HRAT",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_orange.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_orange.png",iconSize:[22,30]});else if(S("2LRAT",n)!=-1||S("2HRAT",n)!=-1||S("2RRAT",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_yellow.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_yellow.png",iconSize:[22,30]});else if(S("3LRAT",n)!=-1||S("3HRAT",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_green.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_green.png",iconSize:[22,30]});else if(S("4RAT",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_blue.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_blue.png",iconSize:[22,30]});else if(S("iGEN",n)!=-1||S("iGH_meas",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_violet.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_violet.png",iconSize:[22,30]});else if(S("TIME",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_black.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_black.png",iconSize:[22,30]});else if(S("iWEB",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_brown.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_brown.png",iconSize:[22,30]});else if(S("iDCP",n)!=-1||S("iGH",n)!=-1||S("SPIKE",n)!=-1||S("3DCP",n)!=-1||S("4DCP",n)!=-1||S("3GH",n)!=-1||S("4GH",n)!=-1)i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_pink.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_pink.png",iconSize:[22,30]});else{if(S("GAP",n)==-1&&S("SHFT",n)==-1&&S("COMP",n)==-1)return;i=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+t+"_gray.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+t+"_gray.png",iconSize:[22,30]})}}});var s=r.getPopup().getContent();r.getPopup().setContent(s+="</br>"+o),r.setIcon(i)})})}function _(){e("#togglePeople").toggleClass("btn-default btn-primary"),J=!J,J?(b(),B=setInterval(b,3e4)):(D.removeLayer(P),clearInterval(B))}function b(){D.hasLayer(P)||D.addLayer(P),e.ajax({type:"GET",contentType:"application/json; charset=utf-8",url:trackerURL,data:trackerData,async:!1,dataType:"jsonp",success:function(a){a.Data&&a.Data.length>0?(P.clearLayers(),e(a.Data).each(function(e,a){var t=[parseFloat(a.Latitude),parseFloat(a.Longitude)],i=a.Date,o=a.Accuracy,n=a["Speed(mph)"],s=a["Altitude(m)"],l=a.DeviceName,p=l.split("-")[1],c=a.DeviceID,g=r(i),d=g.format("MMMM Do YYYY, h:mm:ss a"),m=g.valueOf()/1e3,h=(new Date).getTime()/1e3,f=L.icon({iconUrl:"./images/person_icons/"+p+".png",iconSize:[40,40]}),u=L.marker(t,{icon:f}).bindPopup("<b>User Data</b></br><b>Timestamp:</b> "+d+"</br><b>Color:</b> "+p+"</br><b>Speed(mph):</b> "+n+"</br><b>Altitude(m):</b> "+s+"</br><b>Accuracy(m):</b> "+o);h-m<129600?(P.addLayer(u),console.log("deviceID: ",c," | color: ",p," | date: ",d," | location: ",t," | speed: ",n," mph | altitude: ",s," meters | accuracy: ",o," meters")):console.log(p,"was skipped for no update.")})):console.log("Error retreiving user locations")},error:function(e,a,t){alert("Unexpected error has occurred: "+e.statusText+" ("+e.status+")")}})}function S(e,a){for(var t=0;t<a.length;t++)if(a[t].match(new RegExp(e,"i")))return t;return-1}function N(e){switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="Terrain";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}C&&D.removeLayer(C),C=i.basemapLayer(e),D.addLayer(C),O&&D.removeLayer(O),"Gray"!==e&&"Imagery"!==e&&"Terrain"!==e||(O=i.basemapLayer(e+"Labels"),D.addLayer(O))}function w(a){e("#NWSlegend").empty(),e("#radarTimeStamp").empty(),T(),"sr_NWS_layer"==a&&(D.addLayer(U),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_N0R_Legend_0.gif'/>")),"lr_NWS_layer"==a&&(D.addLayer(A),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_N0Z_Legend_0.gif'/>")),"storm_NWS_layer"==a&&(D.addLayer(z),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_NTP_Legend_0.gif'/>")),"reflectivity_NWS_conus_layer"==a&&(D.addLayer(W),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_NCR_Legend_0.gif'/>"))}function T(){e("#NWSlegend").empty(),e("#radarTimeStamp").empty(),D.removeLayer(U),D.removeLayer(A),D.removeLayer(z),D.removeLayer(W)}function I(){e("#centerSelect").val(e("#centerSelect option:first-child").val()),e("#tripSelect").find("option:gt(0)").remove(),e("#togglePeople").hasClass("btn-primary")&&_(),"Show Go2"==e("#toggleGo2").text()&&u(),R.clearLayers(),k.clearLayers(),T(),e(".radarBtn").removeClass("active"),D.setView([MapY,MapX],7)}var D,O,C,G,k,R,x,P,A,U,z,W,B,E={},F={},J=!1;e(document).ready(function(){console.log("Application Information: production version 1.0.6"),e("#appVersion").html("Application Information: production version 1.0.6"),D=L.map("mapDiv",{zoomControl:!1}),L.control.zoom({position:"topright"}).addTo(D),L.control.scale().addTo(D),C=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ",maxZoom:16}).addTo(D),D.setView([MapY,MapX],MapZoom),G=L.featureGroup().addTo(D),k=L.featureGroup().addTo(D),R=L.featureGroup().addTo(D),x=L.featureGroup().addTo(D),P=L.featureGroup().addTo(D),A=L.layerGroup(),U=L.layerGroup(),z=L.layerGroup(),W=L.layerGroup(),h(),m(),n(),e("#centerSelect").on("change",function(){var a=e("#centerSelect :selected").text();e('#tripSelect option[value!="default"]').remove(),p(a)}),e("#tripSelect").on("change",function(){var a={tripName:e("#tripSelect :selected").text(),tripOwner:e("#tripSelect :selected").attr("value"),tripCenter:e("#centerSelect :selected").text()};c(a)}),e("#go2typeSelect").on("change",function(){var a=e("#go2typeSelect :selected").text();y(a)}),e(".basemapBtn").click(function(){e(".basemapBtn").removeClass("slick-btn-selection"),e(this).addClass("slick-btn-selection");var a=this.id.replace("btn","");N(a)}),e("#mobile-main-menu").click(function(){e("body").toggleClass("isOpenMenu")}),e("#toggleGo2").click(function(){u()}),e("#togglePeople").click(function(){_()}),e(".radarBtn").click(function(){if(e(this).hasClass("slick-btn-selection"))e(this).removeClass("slick-btn-selection"),T();else{e(".radarBtn").removeClass("slick-btn-selection"),e(this).addClass("slick-btn-selection");var a=e(this).val();w(a)}}),e("#resetView").click(function(){I()}),e("#aboutButton").click(function(){e("#aboutModal").modal("show")}),x.on("click",function(e){s(e)})})}).call(a,t(1),t(2),t(3),t(22),t(30))}]);