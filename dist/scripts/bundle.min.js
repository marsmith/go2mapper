webpackJsonp([0],[function(e,t,a){(function(e,t,a,i,r){function o(){e.getJSON(noaaSitesJSON,function(t){e.each(t,function(e,t){W[e]&&(W[e].properties.ahpsID=t)})})}function n(){z.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/Conus/RadarImg/northeast_radaronly.gif",[[35.13102,-81.613834],[49.508061,-66.517938]])),U.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/ENX_N0Z_0.gif",[[38.578726,-78.420367],[46.578726,-69.693094]])),U.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/BGM_N0Z_0.gif",[[38.193727,-80.341364],[46.193727,-71.614092]])),U.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/BUF_N0Z_0.gif\t",[[38.941729,-83.093363],[46.941729,-74.36609]])),U.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/TYX_N0Z_0.gif",[[39.748728,-80.036364],[47.748728,-71.309091]])),U.addLayer(L.imageOverlay("https://radar.weather.gov/ridge/RadarImg/N0Z/OKX_N0Z_0.gif",[[36.858728,-77.220362],[44.858728,-68.493089]])),A.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/ENX_N0R_0.gif",[[39.894591,-76.989871],[45.267637,-71.128366]])),A.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/BGM_N0R_0.gif",[[39.526025,-78.893004],[44.866266,-73.067287]])),A.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/BUF_N0R_0.gif",[[40.241795,-81.680043],[45.646381,-75.78413]])),A.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/TYX_N0R_0.gif",[[41.012603,-78.662387],[46.48944,-72.687656]])),A.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/N0R/OKX_N0R_0.gif",[[38.245599,-75.712675],[43.476892,-70.00581]])),x.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/ENX_NTP_0.gif",[[39.894178,-76.99032],[45.268049,-71.127915]])),x.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/BGM_NTP_0.gif",[[39.52562,-78.893445],[44.866669,-73.066846]])),x.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/BUF_NTP_0.gif",[[40.241382,-81.680491],[45.646793,-75.78368]])),x.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/TYX_NTP_0.gif",[[41.01219,-78.662836],[46.489851,-72.687205]])),x.addLayer(L.imageOverlay(" https://radar.weather.gov/ridge/RadarImg/NTP/OKX_NTP_0.gif",[[38.245202,-75.713107],[43.477288,-70.005377]]))}function s(t){if("sw"===t.layer.properties.siteType||"gw"===t.layer.properties.siteType){var a="00060,72019,62619",i="P7D";e.getJSON("https://staging.waterservices.usgs.gov/nwis/iv/?format=nwjson&sites="+t.layer.properties.siteID+"&parameterCd="+a+"&period="+i,function(a){if(!a.data||a.data[0].time_series_data.length<=0)return void console.log("Found an NWIS site, but it had no data in waterservices: ",t.layer.properties.siteID);var i=[],r="Discharge, cfs",o="Discharge: {point.y} cfs";"gw"===t.layer.properties.siteType&&(r="Elevation, ft",o="Elevation: {point.y} ft");var n={tooltip:{pointFormat:o},showInLegend:!1,data:a.data[0].time_series_data};if(i.push(n),W[t.layer.properties.siteID].properties.ahpsID){console.log("Found AHPS site: ",W[t.layer.properties.siteID].properties.ahpsID,"  Querying AHPS...");var s="https://water.weather.gov/ahps2/hydrograph_to_xml.php?gage="+t.layer.properties.ahpsID+"&output=xml",c='select * from xml where url="'+s+'"';e.ajax({url:"https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(c),dataType:"xml",success:function(a){var n=[];if(e(a).find("forecast").find("datum").each(function(){var t=e(this).find("valid").text(),a=e(this).find("secondary").attr("units"),i=parseFloat(e(this).find("secondary").text());"kcfs"===a&&(i*=1e3);var r=new Date(t)/1;n.push([r,i])}),n.sort(),n.length<=1)console.log("Found an AHPS Site, but no AHPS data was found: ",t.layer.properties.siteID,t.layer.properties.ahpsID);else{var s={tooltip:{pointFormat:o},showInLegend:!0,color:"#009933",name:"NWS River Forecast (AHPS)",data:n};i.push(s)}l(i,r)}})}else console.log("Did not find AHPS site for USGS Site: ",t.layer.properties.siteID),l(i,r)})}}function l(a,i){e("#graphContainer").show(),t.setOptions({global:{useUTC:!1},lang:{thousandsSep:","}}),t.chart("graphContainer",{chart:{type:"line",spacingTop:20,spacingLeft:0,spacingBottom:0},title:{text:""},credits:{enabled:!1},xAxis:{type:"datetime",labels:{formatter:function(){return t.dateFormat("%m/%d",this.value)},align:"center",tickInterval:1728e5}},yAxis:{title:{text:i}},series:a})}function c(t){R.clearLayers(),k.clearLayers(),C.eachLayer(function(a){var i=a.getLayers();e.each(i,function(e,a){a.feature.properties.Office===t&&I.fitBounds(a.getBounds())})}),e("#tripSelect").show(),e.each(E,function(a,i){i.WSC.OfficeName.indexOf(t)!==-1&&e.each(i.WSC.Trip,function(t,a){e("#tripSelect").append(e("<option></option>").attr("value",a.TripOwner).text(a.TripName))})})}function p(t){R.clearLayers(),k.clearLayers(),hullPoints=[],e.each(E,function(a,i){i.WSC.OfficeName.indexOf(t.tripCenter)!==-1&&e.each(i.WSC.Trip,function(a,i){i.TripName==t.tripName&&e.each(i.Sites,function(e,t){d("siteslayer",t)})})}),R.getLayers().length<=2?I.fitBounds(R.getBounds()):g(t)}function g(e){var t=a(R.toGeoJSON()),i=L.geoJSON(t).bindPopup("<b>Center: </b>"+e.tripCenter+"</br><b>Trip Name: </b>"+e.tripName+"</br><b>Trip Owner: </b>"+e.tripOwner,{minWidth:200});k.addLayer(i),I.fitBounds(k.getBounds())}function d(t,a){var i=L.icon({iconUrl:"./images/symbols/selected_site_yellow.png",iconSize:[64,64]});e.each(W,function(e,t){if(t.properties.siteID===a){var r=L.marker(t.getLatLng(),{icon:i,pane:"shadowPane"});R.addLayer(r)}})}function m(){e.getJSON(subDistGeoJSON,function(t){e.each(t.features,function(t,a){e("#centerSelect").append(e("<option></option>").attr("value",a.properties.Office).text(a.properties.Office))});var a={color:"#ff8c66",weight:0,opacity:.3},i=L.geoJSON(t,{style:a});C.addLayer(i)})}function u(){var t=L.icon({iconUrl:"./images/symbols/dot_small.png",iconSize:[8,8]});e.getJSON(siteListJSON,function(a){e.each(a.SitesCollection,function(e,a){W[a.SiteID]=L.marker([a.Attributes.latDD,a.Attributes.lonDD],{icon:t}),W[a.SiteID].properties={},W[a.SiteID].properties.siteID=a.SiteID,W[a.SiteID].properties.siteName=a.Attributes.station_nm,W[a.SiteID].properties.siteType=a.Attributes.site_type,W[a.SiteID].properties.popupContent="<b>"+a.SiteID+"</b></br></br>"+a.Attributes.station_nm+'</br><a href="https://waterdata.usgs.gov/nwis/inventory/?site_no='+a.SiteID+'" target="_blank">Access Data</a></br></br>',W[a.SiteID].bindPopup(W[a.SiteID].properties.popupContent,{minWidth:300}),G.addLayer(W[a.SiteID])}),f(),h(go2warningsJSON),o()})}function f(){e.getJSON(tripListJSON,function(t){E=t.TripsCollection,e.each(E,function(t,a){e.each(a,function(t,a){e.each(a.Trip,function(t,i){e.each(i.Sites,function(e,t){W[t]&&(W[t].properties.tripName=i.TripName,W[t].properties.tripOwner=i.TripOwner,W[t].properties.popupContent="<b>"+t+"</b></br></br>"+W[t].properties.siteName+'</br><a href="https://waterdata.usgs.gov/nwis/inventory/?site_no='+t+'" target="_blank">Access Data</a></br></br><b>Office: </b>'+a.OfficeName+"</br><b>Trip Name: </b>"+W[t].properties.tripName+"</br><b>Trip Owner: </b>"+W[t].properties.tripOwner+'<div id="graphContainer" style="width:100%; height:200px;display:none;"></div>',W[t].getPopup().setContent(W[t].properties.popupContent))})})})})})}function y(){e("#toggleGo2").text(function(e,t){return"Show Go2Lite"===t?(h(go2liteWarningsJSON),"Show Go2"):(h(go2warningsJSON),"Show Go2Lite")})}function h(t){R.clearLayers(),k.clearLayers(),e.getJSON(t,function(t){e("#loading").hide(),e("#time").html("Data queried: "+t.metadata.created),e.each(W,function(a,i){i.getPopup().setContent(i.properties.popupContent);var r=L.icon({iconUrl:"./images/symbols/dot_small.png",iconSize:[8,8]}),o="",n=[];e.each(t.SitesCollection,function(e,t){if(i.properties.siteID===t.items.SiteID){!i.properties.tripName;var a=i.properties.siteType;for(var s in t.items.goflags)if("1DCP"!=t.items.goflags[s].go2flag){o=o+'<div class="alert alert-warning"><b>'+t.items.goflags[s].go2flag+":</b> "+t.items.goflags[s].go2msg+"</div>";var l=t.items.goflags[s].go2flag;"iGH"==t.items.goflags[s].go2flag&&t.items.goflags[s].go2msg.indexOf("meas")!=-1&&(l="iGH_meas"),n.push(l)}if(S("1DCP",n)!=-1||S("2DCP",n)!=-1||S("1GH",n)!=-1||S("2GH",n)!=-1||S("MODEM",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_red.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_red.png",iconSize:[22,30]});else if(S("1LRAT",n)!=-1||S("1HRAT",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_orange.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_orange.png",iconSize:[22,30]});else if(S("2LRAT",n)!=-1||S("2HRAT",n)!=-1||S("2RRAT",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_yellow.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_yellow.png",iconSize:[22,30]});else if(S("3LRAT",n)!=-1||S("3HRAT",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_green.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_green.png",iconSize:[22,30]});else if(S("4RAT",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_blue.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_blue.png",iconSize:[22,30]});else if(S("iGEN",n)!=-1||S("iGH_meas",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_violet.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_violet.png",iconSize:[22,30]});else if(S("TIME",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_black.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_black.png",iconSize:[22,30]});else if(S("iWEB",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_brown.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_brown.png",iconSize:[22,30]});else if(S("iDCP",n)!=-1||S("iGH",n)!=-1||S("SPIKE",n)!=-1||S("3DCP",n)!=-1||S("4DCP",n)!=-1||S("3GH",n)!=-1||S("4GH",n)!=-1)r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_pink.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_pink.png",iconSize:[22,30]});else{if(S("GAP",n)==-1&&S("SHFT",n)==-1&&S("COMP",n)==-1)return;r=n.length>1?L.icon({iconUrl:"images/symbols/multi_"+a+"_gray.png",iconSize:[42,40]}):L.icon({iconUrl:"images/symbols/"+a+"_gray.png",iconSize:[22,30]})}}});var s=i.getPopup().getContent();i.getPopup().setContent(s+="</br>"+o),i.setIcon(r)})})}function b(){e("#togglePeople").toggleClass("btn-default btn-primary"),M=!M,M?(v(),B=setInterval(v,3e4)):(I.removeLayer(P),clearInterval(B))}function v(){I.hasLayer(P)||I.addLayer(P),e.ajax({type:"GET",contentType:"application/json; charset=utf-8",url:trackerURL,data:trackerData,async:!1,dataType:"jsonp",success:function(t){t.Data&&t.Data.length>0?(P.clearLayers(),e(t.Data).each(function(e,t){var a=[parseFloat(t.Latitude),parseFloat(t.Longitude)],r=t.Date,o=t.Accuracy,n=t["Speed(mph)"],s=t["Altitude(m)"],l=t.DeviceName,c=l.split("-")[1],p=t.DeviceID,g=i(r),d=g.format("MMMM Do YYYY, h:mm:ss a"),m=g.valueOf()/1e3,u=(new Date).getTime()/1e3,f=L.icon({iconUrl:"./images/person_icons/"+c+".png",iconSize:[40,40]}),y=L.marker(a,{icon:f}).bindPopup("<b>User Data</b></br><b>Timestamp:</b> "+d+"</br><b>Color:</b> "+c+"</br><b>Speed(mph):</b> "+n+"</br><b>Altitude(m):</b> "+s+"</br><b>Accuracy(m):</b> "+o);u-m<129600?(P.addLayer(y),console.log("deviceID: ",p," | color: ",c," | date: ",d," | location: ",a," | speed: ",n," mph | altitude: ",s," meters | accuracy: ",o," meters")):console.log(c,"was skipped for no update.")})):console.log("Error retreiving user locations")},error:function(e,t,a){alert("Unexpected error has occurred: "+e.statusText+" ("+e.status+")")}})}function S(e,t){for(var a=0;a<t.length;a++)if(t[a].match(new RegExp(e,"i")))return a;return-1}function _(e){switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="Terrain";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}O&&I.removeLayer(O),O=r.basemapLayer(e),I.addLayer(O),D&&I.removeLayer(D),"Gray"!==e&&"Imagery"!==e&&"Terrain"!==e||(D=r.basemapLayer(e+"Labels"),I.addLayer(D))}function N(t){e("#NWSlegend").empty(),e("#radarTimeStamp").empty(),w(),"sr_NWS_layer"==t&&(I.addLayer(A),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_N0R_Legend_0.gif'/>")),"lr_NWS_layer"==t&&(I.addLayer(U),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_N0Z_Legend_0.gif'/>")),"storm_NWS_layer"==t&&(I.addLayer(x),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_NTP_Legend_0.gif'/>")),"reflectivity_NWS_conus_layer"==t&&(I.addLayer(z),e("#NWSlegend").append("<img id='LegendImg' src='https://radar.weather.gov/ridge/kml/radarkeyimages/ENX_NCR_Legend_0.gif'/>"))}function w(){e("#NWSlegend").empty(),e("#radarTimeStamp").empty(),I.removeLayer(A),I.removeLayer(U),I.removeLayer(x),I.removeLayer(z)}function T(){e("#centerSelect").val(e("#centerSelect option:first-child").val()),e("#tripSelect").find("option:gt(0)").remove(),e("#togglePeople").hasClass("btn-primary")&&b(),"Show Go2"==e("#toggleGo2").text()&&y(),R.clearLayers(),k.clearLayers(),w(),e(".radarBtn").removeClass("active"),I.setView([MapY,MapX],7)}var I,D,O,C,k,R,G,P,U,A,x,z,B,W={},E={},M=!1;e(document).ready(function(){console.log("Application Information: production version 1.0.6"),e("#appVersion").html("Application Information: production version 1.0.6"),I=L.map("mapDiv",{zoomControl:!1}),L.control.zoom({position:"topright"}).addTo(I),L.control.scale().addTo(I),O=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ",maxZoom:16}).addTo(I),I.setView([MapY,MapX],MapZoom),C=L.featureGroup().addTo(I),k=L.featureGroup().addTo(I),R=L.featureGroup().addTo(I),G=L.featureGroup().addTo(I),P=L.featureGroup().addTo(I),U=L.layerGroup(),A=L.layerGroup(),x=L.layerGroup(),z=L.layerGroup(),u(),m(),n(),e("#centerSelect").on("change",function(){var t=e("#centerSelect :selected").text();e('#tripSelect option[value!="default"]').remove(),c(t)}),e("#tripSelect").on("change",function(){var t={tripName:e("#tripSelect :selected").text(),tripOwner:e("#tripSelect :selected").attr("value"),tripCenter:e("#centerSelect :selected").text()};p(t)}),e(".basemapBtn").click(function(){e(".basemapBtn").removeClass("slick-btn-selection"),e(this).addClass("slick-btn-selection");var t=this.id.replace("btn","");_(t)}),e("#mobile-main-menu").click(function(){e("body").toggleClass("isOpenMenu")}),e("#toggleGo2").click(function(){y()}),e("#togglePeople").click(function(){b()}),e(".radarBtn").click(function(){if(e(this).hasClass("slick-btn-selection"))e(this).removeClass("slick-btn-selection"),w();else{e(".radarBtn").removeClass("slick-btn-selection"),e(this).addClass("slick-btn-selection");var t=e(this).val();N(t)}}),e("#resetView").click(function(){T()}),e("#aboutButton").click(function(){e("#aboutModal").modal("show")}),G.on("click",function(e){s(e)})})}).call(t,a(1),a(2),a(3),a(22),a(30))}]);